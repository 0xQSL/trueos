#!/sbin/openrc-run
# Copyright (c) 2007-2015 The OpenRC Authors.
# See the Authors file at the top-level directory of this distribution and
# https://github.com/OpenRC/openrc/blob/master/AUTHORS
#
# This file is part of OpenRC. It is subject to the license terms in
# the LICENSE file found in the top-level directory of this
# distribution and at https://github.com/OpenRC/openrc/blob/master/LICENSE
# This file may not be copied, modified, propagated, or distributed
# except according to the terms contained in the LICENSE file.

BIN=/sbin/devd
pid="/var/run/devd.pid"
args="$devd_args -d -q"
name="devd"
description="Device State Change Daemon"

depend() {
	need localmount
	after bootmisc network
	keyword -jail -prefix -stop
}

start_pre() {
	sysctl hw.bus.devctl_disable=0 >/dev/null
}

stop_post() {
	sysctl hw.bus.devctl_disable=1 >/dev/null
}

start() {
	ebegin "Starting $name"
	start-stop-daemon --start --exec ${BIN} -b -m -p ${pid} -- ${args} >/var/log/devd.log 2>/var/log/devd.log
	eend $?
}

stop() {
	ebegin "Stopping $name"
	start-stop-daemon --stop --exec ${BIN} -p ${pid}
	eend $?
}
